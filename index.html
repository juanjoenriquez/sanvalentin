<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Juanjo üíò Kriz</title>
  <meta name="theme-color" content="#ff6b9b" />

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    :root{
      --bg1:#f7d4dc;
      --bg2:#f3c7cf;
      --glass1: rgba(255,255,255,.62);
      --glass2: rgba(255,255,255,.34);
      --ink: rgba(0,0,0,.80);
      --muted: rgba(0,0,0,.58);
      --shadow: 0 18px 55px rgba(0,0,0,.16);
      --shadow2: 0 10px 28px rgba(0,0,0,.10);
      --radius: 22px;
      --accent:#ff2d55;
      --accent2:#ff7aa2;
      --ok:#00c389;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1000px 700px at 20% 15%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(900px 700px at 78% 18%, rgba(255,255,255,.35), transparent 62%),
        linear-gradient(145deg, var(--bg1), var(--bg2));
      overflow:hidden;
      color: var(--ink);
    }

    .frame{
      position:relative;
      width:min(980px, 96vw);
      height:min(860px, 92vh);
      margin:auto;
      top:50%;
      transform: translateY(-50%);
      border-radius: 26px;
      overflow:hidden;
      box-shadow: var(--shadow);
      background:
        radial-gradient(1200px 900px at 10% 0%, rgba(255,255,255,.55), transparent 55%),
        linear-gradient(160deg, rgba(255,255,255,.35), rgba(255,255,255,.20));
      border: 1px solid rgba(255,255,255,.55);
      isolation:isolate;
    }

    canvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      display:block;
      z-index: 1;
      pointer-events:none;
    }

    .glass{
      position:absolute;
      inset: 18px;
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
      border: 1px solid rgba(255,255,255,.60);
      box-shadow: var(--shadow2);
      z-index: 2;
    }

    .screen{
      position:absolute;
      inset: 0;
      z-index: 3;
      display:grid;
      place-items:center;
      padding: 22px;
    }

    .card{
      width:min(860px, 92vw);
      border-radius: 26px;
      background: linear-gradient(180deg, var(--glass1), var(--glass2));
      border: 1px solid rgba(255,255,255,.70);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 26px;
      position:relative;
      overflow:hidden;
    }

    .badgeRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      margin-bottom: 18px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(255,255,255,.70);
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
      font-size: 13px;
      color: rgba(0,0,0,.62);
      font-weight: 900;
      user-select:none;
    }

    .title{
      font-size: clamp(22px, 3.2vw, 34px);
      font-weight: 1000;
      letter-spacing: .2px;
      margin: 10px 0 10px;
      text-align:center;
    }

    .subtitle{
      text-align:center;
      margin: 0 0 18px;
      color: var(--muted);
      line-height:1.35;
      font-weight: 800;
    }

    /* INTRO */
    .introWrap{
      display:grid;
      place-items:center;
      padding: 14px 0 4px;
      gap: 16px;
    }

    .heartBtn{
      width: 150px;
      height: 150px;
      border-radius: 999px;
      border: 0;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.85), rgba(255,255,255,.20));
      box-shadow: 0 18px 45px rgba(0,0,0,.12);
      position:relative;
      display:grid;
      place-items:center;
      user-select:none;
      transform: translateZ(0);
    }
    .heartBtn:active{ transform: scale(.99); }

    .bigHeart{
      width: 58px;
      height: 58px;
      transform: rotate(-45deg);
      background: linear-gradient(180deg, var(--accent2), var(--accent));
      border-radius: 12px 0 12px 0;
      position:relative;
      box-shadow: 0 14px 24px rgba(255,45,85,.25);
      animation: beat 1.1s ease-in-out infinite;
    }
    .bigHeart:before,.bigHeart:after{
      content:"";
      position:absolute;
      width: 58px;
      height: 58px;
      border-radius: 50%;
      background: inherit;
    }
    .bigHeart:before{ top:-29px; left:0; }
    .bigHeart:after{ top:0; left:29px; }

    @keyframes beat{
      0%,100%{ transform: rotate(-45deg) scale(1); }
      50%{ transform: rotate(-45deg) scale(1.12); }
    }

    .hint{
      font-weight: 850;
      color: rgba(0,0,0,.55);
      font-size: 13px;
      text-align:center;
      line-height:1.35;
    }

    /* QUESTION */
    .question{
      font-size: clamp(20px, 3vw, 32px);
      font-weight: 1000;
      text-align:center;
      margin: 6px 0 4px;
    }
    .questionSub{
      text-align:center;
      margin: 0 0 18px;
      color: var(--muted);
      font-weight: 850;
    }

    .btnArea{
      position:relative;
      display:flex;
      justify-content:center;
      align-items:center;
      gap: 14px;
      margin-top: 10px;
      min-height: 130px;
    }

    .btn{
      border:0;
      cursor:pointer;
      border-radius: 16px;
      padding: 14px 18px;
      font-weight: 1000;
      font-size: 16px;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      transition: transform .12s ease, filter .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      touch-action: manipulation;
      position:relative;
      white-space:nowrap;
    }
    .btn:active{ transform: scale(.98); }

    .btnYes{
      background: linear-gradient(180deg, rgba(0,195,137,.98), rgba(0,160,115,.98));
      color: rgba(255,255,255,.96);
    }
    .btnNo{
      background: rgba(255,255,255,.75);
      color: rgba(0,0,0,.72);
      border: 1px solid rgba(255,255,255,.75);
    }

    /* RESULT */
    .layout2{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 820px){
      .layout2{ grid-template-columns: 1fr; }
    }

    .panel{
      border-radius: 22px;
      padding: 18px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.70);
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
    }

    .loveTitle{
      font-size: 22px;
      margin: 0 0 10px;
      font-weight: 1000;
    }

    .loveText{
      margin: 0;
      white-space: pre-wrap;
      line-height: 1.5;
      color: rgba(0,0,0,.72);
      font-weight: 750;
      font-size: 16px;
    }

    .sig{
      margin-top: 12px;
      font-weight: 1000;
      color: rgba(0,0,0,.70);
    }

    .timerTitle{
      margin: 0 0 10px;
      font-weight: 1000;
      color: rgba(0,0,0,.62);
    }

    .timerGrid{
      display:grid;
      grid-template-columns: repeat(2,1fr);
      gap: 10px;
    }

    .tile{
      border-radius: 18px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(255,255,255,.75);
      padding: 14px;
      text-align:center;
    }

    .num{
      font-size: 34px;
      font-weight: 1100;
      letter-spacing: .3px;
    }
    .lab{
      margin-top: 4px;
      color: rgba(0,0,0,.55);
      font-weight: 900;
      font-size: 13px;
    }

    .micro{
      margin-top: 12px;
      color: rgba(0,0,0,.52);
      font-weight: 850;
      font-size: 12px;
      line-height:1.35;
    }

    .toast{
      position:absolute;
      left:50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255,255,255,.75);
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 13px;
      color: rgba(0,0,0,.68);
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 9;
      text-align:center;
      max-width: 92%;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-6px);
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div class="frame">
    <canvas id="fx"></canvas>
    <div class="glass"></div>

    <div class="screen">
      <div class="card">

        <div class="badgeRow">
          <div class="badge">üíñ Interactivo</div>
          <div class="badge" id="badgeRight">Toca el coraz√≥n</div>
        </div>

        <!-- STEP 1 -->
        <section id="step1">
          <div class="title">Kriz‚Ä¶ tengo una pregunta para ti</div>
          <div class="subtitle">Toca el coraz√≥n y mira lo que pasa ‚ú®</div>

          <div class="introWrap">
            <button class="heartBtn" id="heartStart" type="button" aria-label="Tocar coraz√≥n">
              <div class="bigHeart"></div>
            </button>
            <div class="hint">Tip: despu√©s podr√°s jugar con los corazones que caen üíó</div>
          </div>
        </section>

        <!-- STEP 2 -->
        <section id="step2" class="hidden">
          <div class="title">Para el amor de mi vida: Kriz</div>
          <div class="question">¬øQuieres ser mi Valent√≠n? üíò</div>
          <div class="questionSub">Elige con el coraz√≥n‚Ä¶ (s√≠, as√≠ de directo)</div>

          <div class="btnArea" id="btnArea">
            <button class="btn btnYes" id="yesBtn" type="button">S√≠, quiero üíó</button>
            <button class="btn btnNo" id="noBtn" type="button">No‚Ä¶</button>
          </div>

          <div class="hint">Si intentas decir ‚Äúno‚Äù, el bot√≥n se pone nervioso ü§≠</div>
        </section>

        <!-- STEP 3 -->
        <section id="step3" class="hidden">
          <div class="layout2">
            <div class="panel">
              <div class="loveTitle">Kriz ‚ù§Ô∏è</div>
              <p class="loveText" id="loveText"></p>
              <div class="sig">‚Äî Juanjo</div>
            </div>

            <div class="panel">
              <div class="timerTitle">Mi amor por ti comenz√≥ hace‚Ä¶</div>
              <div class="timerGrid">
                <div class="tile">
                  <div class="num" id="d">0</div><div class="lab">d√≠as</div>
                </div>
                <div class="tile">
                  <div class="num" id="h">0</div><div class="lab">horas</div>
                </div>
                <div class="tile">
                  <div class="num" id="m">0</div><div class="lab">minutos</div>
                </div>
                <div class="tile">
                  <div class="num" id="s">0</div><div class="lab">segundos</div>
                </div>
              </div>

              <div class="micro" id="deliveryNote">
                Tip: toca/clickea en cualquier parte para lanzar una mini explosi√≥n de corazones üí•üíó
              </div>
            </div>
          </div>
        </section>

        <div class="toast" id="toast">üíå</div>

      </div>
    </div>
  </div>

<script>
  // ========= CONFIG =========
  const CONFIG = {
    fromName: "Juanjo",
    toName: "Kriz",
    startDate: "2022-10-01T00:00:00-05:00", // 01-oct-2022 sin hora (Ecuador)
    notifyEmail: "ing.juanjoenriquez@gmail.com",

    // PON TUS DATOS REALES:
    EMAILJS_PUBLIC_KEY: "4fB7EB9WHRZ8qpR7Y",
    EMAILJS_SERVICE_ID: "service_sy7nwni",
    EMAILJS_TEMPLATE_ID: "template_5fbww3x",

    noEscapesEnabled: true,
    allowNoClickAfterAttempts: 7
  };

  // Mensaje rom√°ntico (s√≠, en serio)
  const LOVE_MESSAGE =
`Si pudiera escoger un lugar seguro, ser√≠a a tu lado.
Contigo entend√≠ que el amor no es ruido, es paz. Es esa confianza silenciosa de saber que, pase lo que pase, estamos en el mismo equipo.

Gracias por tu forma de mirar, por tu paciencia cuando yo me acelero, y por esa ternura que aparece cuando menos la espero.

Hoy no te escribo para impresionarte, te escribo para recordarte algo simple:
me haces bien‚Ä¶ y por eso te elijo, todos los d√≠as.

Te amo. üíó`;

  // ========= HELPERS =========
  const $ = (id)=>document.getElementById(id);
  const step1 = $("step1"), step2 = $("step2"), step3 = $("step3");
  const badgeRight = $("badgeRight");
  const toast = $("toast");

  function showToast(text){
    toast.textContent = text;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove("show"), 1200);
  }

  function emailIsConfigured(){
    return (
      CONFIG.EMAILJS_PUBLIC_KEY && CONFIG.EMAILJS_SERVICE_ID && CONFIG.EMAILJS_TEMPLATE_ID &&
      !String(CONFIG.EMAILJS_PUBLIC_KEY).includes("TU_") &&
      !String(CONFIG.EMAILJS_SERVICE_ID).includes("TU_") &&
      !String(CONFIG.EMAILJS_TEMPLATE_ID).includes("TU_")
    );
  }

  try{
    if(window.emailjs && emailIsConfigured()){
      emailjs.init({ publicKey: CONFIG.EMAILJS_PUBLIC_KEY });
    }
  }catch(e){}

  async function sendAnswerEmail(answer){
    if(!window.emailjs || !emailIsConfigured()){
      return { ok:false, reason:"not_configured" };
    }
    const payload = {
      to_email: CONFIG.notifyEmail,
      to_name: CONFIG.fromName,
      from_name: CONFIG.toName,
      answer: answer,
      when: new Date().toLocaleString(),
      user_agent: navigator.userAgent
    };
    try{
      await emailjs.send(CONFIG.EMAILJS_SERVICE_ID, CONFIG.EMAILJS_TEMPLATE_ID, payload);
      return { ok:true };
    }catch(err){
      return { ok:false, reason:"send_failed", error: err };
    }
  }

  // ========= CANVAS FX =========
  const canvas = $("fx");
  const ctx = canvas.getContext("2d", { alpha:true });
  let W=0,H=0,DPR=1;
  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = canvas.clientWidth = canvas.parentElement.clientWidth;
    H = canvas.clientHeight = canvas.parentElement.clientHeight;
    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener("resize", resize);
  resize();

  const palette = ["#ff2d55","#ff7aa2","#ff4f79","#ffd166","#ff8fab","#ffb3c7","#ff6b6b"];
  const parts = [];
  let running = false;
  let last = performance.now();

  function rand(a,b){ return a + Math.random()*(b-a); }

  function drawHeart(x,y,s,rot,color,alpha){
    ctx.save();
    ctx.globalAlpha = alpha;
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.scale(s,s);

    ctx.beginPath();
    ctx.moveTo(0, -8);
    ctx.bezierCurveTo(8, -14, 16, -2, 0, 16);
    ctx.bezierCurveTo(-16, -2, -8, -14, 0, -8);
    ctx.closePath();

    const g = ctx.createRadialGradient(-3,-6,2, 0,0,20);
    g.addColorStop(0, "rgba(255,255,255,.55)");
    g.addColorStop(0.35, color);
    g.addColorStop(1, "rgba(0,0,0,.12)");
    ctx.fillStyle = g;
    ctx.fill();
    ctx.restore();
  }

  function spawn(x,y,power=1){
    parts.push({
      x,y,
      vx: rand(-45,45)*power,
      vy: rand(-240,-120)*power,
      g: rand(320,520),
      s: rand(0.55,1.05),
      r: rand(0,6.28),
      spin: rand(-2,2),
      a: rand(0.65,0.95),
      c: palette[(Math.random()*palette.length)|0],
      life: rand(1.0,1.8),
    });
    if(parts.length > 320) parts.splice(0, parts.length-320);
  }

  function burst(x,y,n=26){
    for(let i=0;i<n;i++) spawn(x,y, rand(0.7,1.2));
  }

  function startLoop(){
    if(running) return;
    running = true;
    requestAnimationFrame(loop);
  }

  function loop(t){
    const dt = Math.min(0.03, (t-last)/1000);
    last = t;
    ctx.clearRect(0,0,W,H);

    // glow suave
    ctx.save();
    ctx.globalAlpha = 0.12;
    const glow = ctx.createRadialGradient(W*0.5,H*0.35,20, W*0.5,H*0.35, Math.min(W,H)*0.62);
    glow.addColorStop(0,"rgba(255,255,255,.65)");
    glow.addColorStop(1,"rgba(255,255,255,0)");
    ctx.fillStyle = glow;
    ctx.fillRect(0,0,W,H);
    ctx.restore();

    for(let i=parts.length-1;i>=0;i--){
      const p = parts[i];
      p.life -= dt;
      p.vy += p.g*dt;
      p.x += p.vx*dt;
      p.y += p.vy*dt;
      p.r += p.spin*dt;

      drawHeart(p.x,p.y,p.s,p.r,p.c,p.a);

      if(p.life<=0 || p.y>H+140 || p.x<-140 || p.x>W+140) parts.splice(i,1);
    }

    if(running) requestAnimationFrame(loop);
  }

  // ========= FLOW =========
  $("loveText").textContent = LOVE_MESSAGE;

  $("heartStart").addEventListener("click", ()=>{
    badgeRight.textContent = "Resp√≥ndeme‚Ä¶";
    step1.classList.add("hidden");
    step2.classList.remove("hidden");
    showToast("üíò Te tengo una pregunta");
    startLoop();
    // mini lluvia inicial
    burst(W*0.5, H*0.45, 18);
  });

  // ========= NO button escape =========
  const noBtn = $("noBtn");
  const yesBtn = $("yesBtn");
  const btnArea = $("btnArea");
  let noAttempts = 0;

  function moveNo(){
    if(!CONFIG.noEscapesEnabled) return;
    noAttempts++;

    if(noAttempts >= CONFIG.allowNoClickAfterAttempts){
      showToast("Ok‚Ä¶ ya üòÖ");
      return;
    }

    const area = btnArea.getBoundingClientRect();
    const btn = noBtn.getBoundingClientRect();
    const maxX = area.width - btn.width;
    const maxY = area.height - btn.height;

    const x = Math.max(0, Math.min(maxX, Math.random()*maxX));
    const y = Math.max(0, Math.min(maxY, Math.random()*maxY));

    noBtn.style.position = "absolute";
    noBtn.style.left = `${x}px`;
    noBtn.style.top = `${y}px`;

    const phrases = ["üò≥ ¬øSegura?", "ü§≠ Pi√©nsalo‚Ä¶", "üíò No me hagas eso", "üôà Me da nervios", "ü•∫ Yo s√≠ te elijo"];
    showToast(phrases[(Math.random()*phrases.length)|0]);

    const cx = area.left + x + btn.width/2;
    const cy = area.top + y + btn.height/2;
    const rect = canvas.getBoundingClientRect();
    burst(cx-rect.left, cy-rect.top, 10);
  }

  noBtn.addEventListener("mouseenter", moveNo);
  noBtn.addEventListener("pointerdown", (e)=>{
    if(noAttempts < CONFIG.allowNoClickAfterAttempts){
      e.preventDefault();
      moveNo();
    }
  }, { passive:false });

  noBtn.addEventListener("click", async ()=>{
    if(CONFIG.noEscapesEnabled && noAttempts < CONFIG.allowNoClickAfterAttempts) return;

    badgeRight.textContent = "Anotado‚Ä¶";
    showToast("üìù Registrado");
    await sendAnswerEmail("NO");
    // igual muestra pantalla final para que no quede raro
    showFinal();
  });

  // ========= YES =========
  yesBtn.addEventListener("click", async ()=>{
    badgeRight.textContent = "üíå Enviando‚Ä¶";
    showToast("üíå Enviando respuesta");
    const res = await sendAnswerEmail("S√ç");
    if(res.ok) showToast("‚úÖ Enviado a Juanjo");
    else showToast("‚úÖ Listo (activa EmailJS si falta)");
    showFinal(true);
  });

  // ========= FINAL + TIMER =========
  let timerOn = false;
  function showFinal(isYes=false){
    step2.classList.add("hidden");
    step3.classList.remove("hidden");
    badgeRight.textContent = isYes ? "Dijo que S√ç üíñ" : "Ok‚Ä¶";
    burst(W*0.5, H*0.52, isYes ? 70 : 24);
    timerOn = true;
  }

  // click para explosi√≥n en final
  document.addEventListener("click", (e)=>{
    if(!timerOn) return;
    const r = canvas.getBoundingClientRect();
    burst(e.clientX - r.left, e.clientY - r.top, 16);
  });

  // contador desde 01-oct-2022
  const start = new Date(CONFIG.startDate).getTime();
  function pad2(n){ return String(n).padStart(2,"0"); }
  function tick(){
    const now = Date.now();
    let diff = Math.max(0, now - start);

    const sec = Math.floor(diff/1000);
    const days = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const mins = Math.floor((sec % 3600) / 60);
    const secs = sec % 60;

    $("d").textContent = days;
    $("h").textContent = pad2(hours);
    $("m").textContent = pad2(mins);
    $("s").textContent = pad2(secs);

    requestAnimationFrame(()=>{}); // micro para suavidad
  }
  setInterval(tick, 1000);
  tick();

  showToast("üíó Toca el coraz√≥n");
</script>
</body>
</html>

